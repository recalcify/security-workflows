name: Secret Scanning and Credential Detection

on:
  push:
      branches: [ main, develop ]
        pull_request:
            branches: [ main, develop ]

            jobs:
              gitleaks:
                  name: GitLeaks Secret Scan
                      runs-on: ubuntu-latest
                          permissions:
                                contents: read
                                      security-events: write
                                          steps:
                                                - name: Checkout code
                                                        uses: actions/checkout@v4
                                                                with:
                                                                          fetch-depth: 0

                                                                                - name: Run GitLeaks scan
                                                                                        uses: gitleaks/gitleaks-action@v2
                                                                                                env:
                                                                                                          GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}
                                                                                                          
                                                                                                            truffleHog:
                                                                                                                name: TruffleHog Secret Detection
                                                                                                                    runs-on: ubuntu-latest
                                                                                                                        permissions:
                                                                                                                              contents: read
                                                                                                                                  steps:
                                                                                                                                        - name: Checkout code
                                                                                                                                                uses: actions/checkout@v4
                                                                                                                                                        with:
                                                                                                                                                                  fetch-depth: 0
                                                                                                                                                                  
                                                                                                                                                                        - name: Run TruffleHog
                                                                                                                                                                                uses: trufflesecurity/trufflehog@main
                                                                                                                                                                                        with:
                                                                                                                                                                                                  path: ./
                                                                                                                                                                                                            base: ${{ github.event.repository.default_branch }}
                                                                                                                                                                                                                      head: HEAD
                                                                                                                                                                                                                      
                                                                                                                                                                                                                        detect-secrets:
                                                                                                                                                                                                                            name: Detect Secrets
                                                                                                                                                                                                                                runs-on: ubuntu-latest
                                                                                                                                                                                                                                    permissions:
                                                                                                                                                                                                                                          contents: read
                                                                                                                                                                                                                                              steps:
                                                                                                                                                                                                                                                    - name: Checkout code
                                                                                                                                                                                                                                                            uses: actions/checkout@v4
                                                                                                                                                                                                                                                            
                                                                                                                                                                                                                                                                  - name: Set up Python
                                                                                                                                                                                                                                                                          uses: actions/setup-python@v4
                                                                                                                                                                                                                                                                                  with:
                                                                                                                                                                                                                                                                                            python-version: '3.x'
                                                                                                                                                                                                                                                                                            
                                                                                                                                                                                                                                                                                                  - name: Install detect-secrets
                                                                                                                                                                                                                                                                                                          run: pip install detect-secrets
                                                                                                                                                                                                                                                                                                          
                                                                                                                                                                                                                                                                                                                - name: Run detect-secrets baseline
                                                                                                                                                                                                                                                                                                                        run: detect-secrets scan --baseline .secrets.baseline || true
                                                                                                                                                                                                                                                                                                                        
                                                                                                                                                                                                                                                                                                                              - name: Verify no new secrets
                                                                                                                                                                                                                                                                                                                                      run: detect-secrets audit .secrets.baseline || true
