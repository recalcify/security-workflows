name: SAST (Static Application Security Testing)

on:name: SAST and Code Analysis

on:
  push:
      branches: [ main, develop ]
        pull_request:
            branches: [ main, develop ]

            jobs:
              codeql:
                  name: CodeQL Analysis
                      runs-on: ubuntu-latest
                          permissions:
                                contents: read
                                      security-events: write
                                          strategy:
                                                fail-fast: false
                                                      matrix:
                                                              language: [ 'javascript', 'python', 'java' ]
                                                                  steps:
                                                                        - name: Checkout code
                                                                                uses: actions/checkout@v4
                                                                                      - name: Initialize CodeQL
                                                                                              uses: github/codeql-action/init@v2
                                                                                                      with:
                                                                                                                languages: ${{ matrix.language }}
                                                                                                                      - name: Autobuild
                                                                                                                              uses: github/codeql-action/autobuild@v2
                                                                                                                                    - name: Perform CodeQL Analysis
                                                                                                                                            uses: github/codeql-action/analyze@v2
                                                                                                                                            
                                                                                                                                              semgrep:
                                                                                                                                                  name: Semgrep Analysis
                                                                                                                                                      runs-on: ubuntu-latest
                                                                                                                                                          permissions:
                                                                                                                                                                contents: read
                                                                                                                                                                      security-events: write
                                                                                                                                                                          steps:
                                                                                                                                                                                - name: Checkout code
                                                                                                                                                                                        uses: actions/checkout@v4
                                                                                                                                                                                              - name: Run Semgrep
                                                                                                                                                                                                      uses: returntocorp/semgrep-action@v1
                                                                                                                                                                                                              with:
                                                                                                                                                                                                                        config: p/security-audit p/owasp-top-ten p/cwe-top-25
                                                                                                                                                                                                                                  generateSarif: true
                                                                                                                                                                                                                                        - name: Upload Semgrep results
                                                                                                                                                                                                                                                uses: github/codeql-action/upload-sarif@v2
                                                                                                                                                                                                                                                        if: always()
                                                                                                                                                                                                                                                                with:
                                                                                                                                                                                                                                                                          sarif_file: semgrep.sarif
  push:
      branches: [ main, develop ]
        pull_request:
            branches: [ main, develop ]

            jobs:
              codeql-analysis:
                  runs-on: ubuntu-latest
                      permissions:
                            contents: read
                                  security-events: write

                                      strategy:
                                            fail-fast: false
                                                  matrix:
                                                          language: [ 'javascript', 'python' ]

                                                              steps:
                                                                    - name: Checkout code
                                                                            uses: actions/checkout@v4

                                                                                  - name: Initialize CodeQL
                                                                                          uses: github/codeql-action/init@v2
                                                                                                  with:
                                                                                                            languages: ${{ matrix.language }}
                                                                                                            
                                                                                                                  - name: Autobuild
                                                                                                                          uses: github/codeql-action/autobuild@v2
                                                                                                                          
                                                                                                                                - name: Perform CodeQL Analysis
                                                                                                                                        uses: github/codeql-action/analyze@v2
                                                                                                                                        
                                                                                                                                          semgrep:
                                                                                                                                              runs-on: ubuntu-latest
                                                                                                                                                  permissions:
                                                                                                                                                        contents: read
                                                                                                                                                              security-events: write
                                                                                                                                                              
                                                                                                                                                                  steps:
                                                                                                                                                                        - name: Checkout code
                                                                                                                                                                                uses: actions/checkout@v4
                                                                                                                                                                                
                                                                                                                                                                                      - name: Run Semgrep
                                                                                                                                                                                              uses: returntocorp/semgrep-action@v1
                                                                                                                                                                                                      with:
                                                                                                                                                                                                                config: >-
                                                                                                                                                                                                                            p/security-audit
                                                                                                                                                                                                                                        p/owasp-top-ten
                                                                                                                                                                                                                                                    p/cwe-top-25
                                                                                                                                                                                                                                                                p/misconfigurations
                                                                                                                                                                                                                                                                          generateSarif: true
                                                                                                                                                                                                                                                                          
                                                                                                                                                                                                                                                                                - name: Upload Semgrep SARIF
                                                                                                                                                                                                                                                                                        uses: github/codeql-action/upload-sarif@v2
                                                                                                                                                                                                                                                                                                if: always()
                                                                                                                                                                                                                                                                                                        with:
                                                                                                                                                                                                                                                                                                                  sarif_file: semgrep.sarif
                                                                                                                                                                                                                                                                                                                  
                                                                                                                                                                                                                                                                                                                    bandit-python:
                                                                                                                                                                                                                                                                                                                        runs-on: ubuntu-latest
                                                                                                                                                                                                                                                                                                                            permissions:
                                                                                                                                                                                                                                                                                                                                  contents: read
                                                                                                                                                                                                                                                                                                                                        security-events: write
                                                                                                                                                                                                                                                                                                                                            
                                                                                                                                                                                                                                                                                                                                                steps:
                                                                                                                                                                                                                                                                                                                                                      - name: Checkout code
                                                                                                                                                                                                                                                                                                                                                              uses: actions/checkout@v4
                                                                                                                                                                                                                                                                                                                                                              
                                                                                                                                                                                                                                                                                                                                                                    - name: Set up Python
                                                                                                                                                                                                                                                                                                                                                                            uses: actions/setup-python@v4
                                                                                                                                                                                                                                                                                                                                                                                    with:
                                                                                                                                                                                                                                                                                                                                                                                              python-version: '3.x'
                                                                                                                                                                                                                                                                                                                                                                                              
                                                                                                                                                                                                                                                                                                                                                                                                    - name: Install Bandit
                                                                                                                                                                                                                                                                                                                                                                                                            run: pip install bandit[toml]
                                                                                                                                                                                                                                                                                                                                                                                                            
                                                                                                                                                                                                                                                                                                                                                                                                                  - name: Run Bandit security scan
                                                                                                                                                                                                                                                                                                                                                                                                                          run: |
                                                                                                                                                                                                                                                                                                                                                                                                                                    bandit -r . -f json -o bandit-report.json || true
                                                                                                                                                                                                                                                                                                                                                                                                                                    
                                                                                                                                                                                                                                                                                                                                                                                                                                          - name: Upload B
